#!/bin/bash
# –°–∫—Ä–∏–ø—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–ª—é—á–µ–π –ø–æ–¥–ø–∏—Å–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π Tauri

set -e

echo "üîë –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–µ–π –ø–æ–¥–ø–∏—Å–∏ –¥–ª—è Tauri Updater"
echo "=============================================="
echo ""

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ª–∏ tauri-cli
if ! command -v cargo &> /dev/null; then
    echo "‚ùå Rust/Cargo –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Rust: https://rustup.rs/"
    exit 1
fi

# –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∫–ª—é—á–∏
echo "–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–∞—Ä—ã –∫–ª—é—á–µ–π..."
cargo install --locked tauri-cli

# –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á
echo ""
echo "üìù –í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –¥–ª—è –∑–∞—â–∏—Ç—ã –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞:"
pnpm tauri signer generate

echo ""
echo "‚úÖ –ö–ª—é—á–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã!"
echo ""
echo "üìÅ –§–∞–π–ª—ã –∫–ª—é—á–µ–π:"
echo "   - signer.key.priv (–ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á, —Ö—Ä–∞–Ω–∏—Ç–µ –≤ —Å–µ–∫—Ä–µ—Ç–µ!)"
echo "   - signer.key.pub (–ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –¥–ª—è tauri.conf.json)"
echo ""
echo "üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞:"
echo "   1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ signer.key.pub –≤ tauri.conf.json ‚Üí plugins.updater.pubkey"
echo "   2. –î–æ–±–∞–≤—å—Ç–µ TAURI_SIGNING_PRIVATE_KEY_PASSWORD –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è"
echo "   3. –î–ª—è CI/CD –¥–æ–±–∞–≤—å—Ç–µ TAURI_SIGNING_PRIVATE_KEY (—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ signer.key.priv)"
echo ""
echo "‚ö†Ô∏è  –í–ê–ñ–ù–û: –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ signer.key.priv –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π!"
